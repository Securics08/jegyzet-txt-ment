<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>V√©gtelen Jegyzet PRO - Full Font Edition</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Monoton&family=Pinyon+Script&family=Nabla&family=Bungee+Shade&family=Ewert&family=Vast+Shadow&family=Creepster&family=Lobster&family=Righteous&family=Faster+One&family=Special+Elite&family=Orbitron&family=Pacifico&family=Press+Start+2P&family=Permanent+Marker&family=Sacramento&family=Silkscreen&family=Codystar&family=Megrim&family=Fredericka+the+Great&family=UnifrakturMaguntia&family=Wallpoet&family=Syncopate&family=Fascinate+Inline&family=Nosifer&family=Rubik+Glitch&family=Bangers&family=Alumni+Sans+Inline+One&family=Iceberg&family=Glass+Antiqua&family=Kranky&family=Great+Vibes&family=Bruno+Ace+SC&family=VT323&family=Montserrat&family=Nunito&family=Oswald&family=Playfair+Display&family=Spectral&family=Ultra&family=Varela+Round&family=Alegreya&family=Roboto+Serif&family=Roboto+Mono&display=swap" rel="stylesheet">

<style>
:root {
    --bg-color: #0e0e0e;
    --panel-color: #1a1a1a;
    --text-color: #eee;
    --border-color: #444;
}

.light-mode {
    --bg-color: #f5f5f5;
    --panel-color: #e0e0e0;
    --text-color: #222;
    --border-color: #bbb;
}

body {
    margin: 0;
    background: var(--bg-color);
    color: var(--text-color);
    font-family: Consolas, monospace;
    transition: background 0.3s, color 0.3s;
}

#topbar {
    display: flex;
    background: var(--panel-color);
    padding: 10px;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    border-bottom: 1px solid var(--border-color);
}

button, select, input {
    background: var(--bg-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 8px 12px;
    font-family: Consolas, monospace;
    font-size: 14px;
    border-radius: 4px;
}

button:hover { filter: brightness(1.3); cursor: pointer; }

.btn-new { border-left: 4px solid #28a745; }
.btn-date { border-left: 4px solid #17a2b8; }
.btn-save { border-left: 4px solid #ffc107; }
.btn-pdf { border-left: 4px solid #e74c3c; background: #3d1a1a !important; }
.btn-dark { border-left: 4px solid #9b59b6; }
.btn-del-note { color: #ff4d4d; border: 1px solid #ff4d4d; }
.btn-del-all { color: #ff4d4d; border: 2px solid #880000; font-weight: bold; }

#pdf-helper {
    position: absolute;
    left: -9999px;
    top: 0;
    width: 800px;
    padding: 40px;
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: 1.6;
}

textarea {
    width: 100vw;
    height: calc(100vh - 110px);
    background: var(--bg-color);
    color: var(--text-color);
    border: none;
    outline: none;
    padding: 20px;
    font-size: 14px;
    resize: none;
    line-height: 1.6;
    box-sizing: border-box;
}

#search { width: 130px; }
</style>
</head>

<body>

<div id="topbar">
    <select id="notes"></select>
    <button class="btn-new" onclick="newNote()">+ √öj</button>

    <input type="number" id="fontSize" value="14" min="8" max="100" oninput="changeSize()">
    <button class="btn-dark" onclick="toggleDarkMode()">üåì S√∂t√©t√≠t≈ë</button>
    <button class="btn-date" onclick="insertDate()">üïí D√°tum</button>
    <button class="btn-save" onclick="downloadTxt()">‚¨á TXT</button>
    <button onclick="importTxt()">üìÇ Import TXT</button>
    <input type="file" id="fileInput" accept=".txt" style="display:none">
    <button class="btn-pdf" onclick="downloadPDF()">üìÑ PDF</button>
    <button class="btn-del-note" onclick="deleteCurrentNote()">üóë T√∂rl√©s</button>
    <button class="btn-del-all" onclick="deleteAllNotes()">‚ö†Ô∏è Reset</button>
    <input id="search" placeholder="Keres√©s..." oninput="searchText()">
</div>

<textarea id="editor" placeholder="√çrj ide valami sz√©pet..."></textarea>
<div id="pdf-helper"></div>

<script>
let notesData = JSON.parse(localStorage.getItem("NOTES_PRO_FINAL")) || { "√údv√∂zl≈ë": "Minden bet≈±t√≠pus visszaker√ºlt a list√°ba!" };
let current = localStorage.getItem("CURRENT_NOTE_PRO_FINAL") || "√údv√∂zl≈ë";
let isDarkMode = true;

const editor = document.getElementById("editor");
const notesSelect = document.getElementById("notes");
const pdfHelper = document.getElementById("pdf-helper");

function refreshList() {
    notesSelect.innerHTML = "";
    for (let n in notesData) {
        let opt = document.createElement("option");
        opt.value = n;
        opt.textContent = n;
        notesSelect.appendChild(opt);
    }
    notesSelect.value = current;
}
refreshList();
editor.value = notesData[current] || "";

function save() {
    notesData[current] = editor.value;
    localStorage.setItem("NOTES_PRO_FINAL", JSON.stringify(notesData));
}
editor.addEventListener("input", save);

notesSelect.onchange = () => {
    save();
    current = notesSelect.value;
    localStorage.setItem("CURRENT_NOTE_PRO_FINAL", current);
    editor.value = notesData[current];
};

function newNote() {
    let name = prompt("√öj jegyzet neve:");
    if (!name || notesData[name]) return;
    notesData[name] = "";
    current = name;
    refreshList();
    editor.value = "";
    save();
}

function deleteCurrentNote() {
    if (confirm("Biztosan t√∂rl√∂d ezt a jegyzetet?")) {
        delete notesData[current];
        current = Object.keys(notesData)[0] || "Alap jegyzet";
        if (!notesData[current]) notesData[current] = "";
        refreshList();
        editor.value = notesData[current];
        save();
    }
}

function deleteAllNotes() {
    if (confirm("MINDEN mentett jegyzetet t√∂r√∂lsz a mem√≥ri√°b√≥l?")) {
        localStorage.clear();
        location.reload();
    }
}

function insertDate() {
    const d = new Date().toLocaleString();
    const start = editor.selectionStart;
    editor.setRangeText(`\n[${d}]\n`, start, editor.selectionEnd, 'end');
    save();
}

function searchText() {
    const q = document.getElementById("search").value.toLowerCase();
    const pos = editor.value.toLowerCase().indexOf(q);
    if (pos !== -1) {
        editor.focus();
        editor.setSelectionRange(pos, pos + q.length);
    }
}

function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    document.body.classList.toggle("light-mode", !isDarkMode);
}

function changeSize() {
    editor.style.fontSize = document.getElementById("fontSize").value + "px";
}

function downloadTxt() {
    const blob = new Blob([editor.value], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = current + ".txt";
    a.click();
}

/* IMPORT TXT */
function importTxt() {
    const fileInput = document.getElementById("fileInput");
    fileInput.click();

    fileInput.onchange = function () {
        const file = fileInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
            const content = e.target.result;

            let fileName = file.name.replace(/\.txt$/i, "");
            let baseName = fileName;
            let counter = 1;

            while (notesData[fileName]) {
                fileName = baseName + "_" + counter;
                counter++;
            }

            notesData[fileName] = content;
            current = fileName;

            refreshList();
            editor.value = content;
            save();
        };

        reader.readAsText(file, "UTF-8");
    };
}

/* PDF */
async function downloadPDF() {
    const { jsPDF } = window.jspdf;

    pdfHelper.style.fontFamily = editor.style.fontFamily;
    pdfHelper.style.fontSize = editor.style.fontSize;
    pdfHelper.style.background = isDarkMode ? "#0e0e0e" : "#f5f5f5";
    pdfHelper.style.color = isDarkMode ? "#eee" : "#222";
    pdfHelper.innerText = editor.value;

    html2canvas(pdfHelper, {
        scale: 2,
        backgroundColor: isDarkMode ? "#0e0e0e" : "#f5f5f5"
    }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const imgWidth = pdfWidth;
        const imgHeight = (canvas.height * pdfWidth) / canvas.width;

        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        pdf.save(current + ".pdf");
    });
}
</script>

</body>
</html>
